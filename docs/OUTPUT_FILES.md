# Output Files Reference

Detailed specification of all CSV output files generated by the validation framework.

---

## Table of Contents

- [Overview](#overview)
- [PhysioNet Pipeline Outputs](#physionet-pipeline-outputs)
- [AD8232 Pipeline Outputs](#ad8232-pipeline-outputs)
- [File Formats](#file-formats)
- [Data Integrity](#data-integrity)

---

## Overview

The validation framework generates CSV files at each processing stage. All output files are saved to the `data_logs/` directory with subdirectories organized by dataset.

### Output Directory Structure

**PhysioNet data:**
```
data_logs/
└── {patient_id}_{segment_id}/
    ├── annotated_outputs.csv
    ├── ECG Digital Dataset.csv
    ├── batch_processed_outputs.csv
    ├── streamed_raw_packets.csv
    └── streamed_data_outputs.csv
```

**AD8232 data:**
```
data_logs/
└── AD8232/
    └── {filename}/
        ├── Digital Dataset.txt
        ├── batch_processed_outputs.csv
        ├── streamed_raw_packets.csv
        └── streamed_data_outputs.csv
```

---

## PhysioNet Pipeline Outputs

### 1. annotated_outputs.csv

**Generated by:** Step 1 - Generate Dataset

**Purpose:** Ground-truth R-peaks extracted from PhysioNet annotations

**Columns:**
- `Sample Index` - Sample number where R-peak occurs (0-indexed)
- `Timestamp (s)` - Time in seconds from start of recording
- `Instantaneous BPM` - Heart rate calculated from RR-interval

**Example:**
```csv
Sample Index,Timestamp (s),Instantaneous BPM
413,1.652,71.4
625,2.5,70.9
836,3.344,71.1
```

**Notes:**
- Sample indices correspond to positions in digital dataset
- BPM calculated as: `60 / (current_peak_time - previous_peak_time)`

### 2. ECG Digital Dataset.csv

**Generated by:** Step 1 - Generate Dataset

**Purpose:** Full digitized ECG signal for batch processing

**Columns:**
- `Expected (Calculated in SW)` - 12-bit digital value (0-4095)


**Example:**
```csv
Expected (Calculated in SW)
1820
1811
1803
1803
1803
1786
1778
```

**Notes:**
- Sampling rate: 250 Hz (4 ms between samples)
- ADC range: 0-4095 (12-bit resolution)
- Converted from analog mV values using min-max scaling
- Used as input for batch processing (Step 3)

### 3. batch_processed_outputs.csv

**Generated by:** Step 3 - Batch Processing
**Purpose:** Software-detected R-peaks on full dataset

**Columns:**
- `Detected R_peak_index` - Sample number where R-peak detected
- `Digital Value` - 12-bit digital value (0-4095)
- `Instantaneous BPM` - Calculated heart rate

**Example:**
```csv
Detected R_peak_index,Digital Value,Instantaneous_BPM
531,1786,90.9
696,1419,86.7
869,1795,93.8
1029,1369,89.3
1197,1428,89.3
1365,1803,92.0
```

**Notes:**
- Processed without real-time constraints
- Establishes software-only baseline for comparison
- Should closely match annotated peaks for accurate algorithms

### 4. streamed_raw_packets.csv

**Generated by:** Step 4 - Real-Time Streaming
**Purpose:** Raw packet data received from ESP32 for integrity analysis

**Columns:**
- `Time` - Time in seconds from start of recording
- `Sample` - 12-bit digital value (0-4095)
- `Packet ID` - ESP32-generated packet ID (8-bit, 0-255)
- `Packet Count` - SW-calculated packet count

**Example:**
```csv
Time,Sample,Packet ID,Packet Count
18.24,1807,1,1
18.244,1794,1,1
18.248,1786,1,1
18.252,1776,1,1
18.256,1773,1,1
18.26,1763,1,1
18.264,1745,1,1
18.268,1751,1,1
18.272,1743,1,1
18.276,1767,1,1
18.28,1753,2,2
18.284,1746,2,2
```

**Notes:**
- Each packet contains 10 samples
- Packets sent at 40 ms intervals (10 samples × 4 ms/sample)
- Packets are used to reduce data transmission overhead 
- CSVs are used during post-processing analysis to verify no packet loss or data corruption during transmission
- Reconstructed into continuous signal for R-peak detection

### 5. streamed_data_outputs.csv

**Generated by:** Step 4 - Real-Time Streaming
**Purpose:** Real-time detected R-peaks and BPM

**Columns:**
- `Detected R_peak_index` - Sample number where R-peak detected
- `Digital Value` - 12-bit digital value (0-4095)
- `Instantaneous BPM` - Calculated heart rate

**Example:**
```csv
Detected R_peak_index,Digital Value,Instantaneous_BPM
660,1710,0.0
860,1819,75.0
1056,1667,76.5
1246,1587,78.9
1450,1717,73.5
1660,1741,71.4
```

**Notes:**
- First BPM is 0.0 (removed during comparison)
- Detected during live streaming with 2-second calibration period
- May differ from batch by 1-2 samples due to packet boundaries
- Subject to real-time processing constraints

---

## AD8232 Pipeline Outputs

### 1. Digital Dataset.txt

**Generated by:** Step 1 - Convert Data to Digital Form
**Purpose:** Formatted dataset for firmware embedding

**Format:** Single-line comma-separated ADC values
```
2048,2052,2055,2058,2061,2063,2065,2067,2068,2070,2071,2072,...
```

**Notes:**
- Already digitized from AD8232 ADC (12-bit)
- No conversion needed (unlike PhysioNet analog data)
- Used to generate firmware array in `gateway.ino`

### 2. batch_processed_outputs.csv

**Same format as PhysioNet batch_processed_outputs.csv**

**Notes:**
- Serves as software baseline (no ground truth available)
- Compared against streamed results to validate consistency

### 3. streamed_raw_packets.csv

**Same format as PhysioNet streamed_raw_packets.csv**

### 4. streamed_data_outputs.csv

**Same format as PhysioNet streamed_data_outputs.csv**

**Notes:**
- No annotated ground truth available for AD8232 data
- Validation relies on batch vs streamed agreement

---

## File Formats

### CSV Encoding

- **Encoding:** UTF-8
- **Delimiter:** Comma (`,`)
- **Line endings:** Unix-style (`\n`)
- **Header:** First row contains column names

### Numeric Precision

- **Sample Index:** Integer
- **ADC Value:** Integer (0-4095)
- **Timestamp:** Float with 3 decimal places (millisecond precision)
- **BPM:** Float rounded to 1 decimal place

---

## Data Integrity

### Validation Checks

**Packet integrity:**
- Sequential packet numbers (no gaps indicate no packet loss)
- 10 samples per packet consistently
- Reconstructed signal matches original dataset length
- Chronological and evenly-spaced timestamps

**Sample alignment:**
- Sample indices match across annotated, batch, and streamed
- Timestamps calculated correctly: `sample_index / sampling_rate`

**BPM calculation:**
- BPM values within physiological range (30-200 BPM typical)
- No negative or infinite values

### Common Issues

**Packet loss:**
- Gaps in `Packet Number` sequence
- Shorter than expected dataset length
- Potential cause: buffer overflow (solution: check buffer size and streaming rate and reconfigure if needed)

**Timestamp misalignment:**
- Timestamps don't match expected sampling rate
- Potential cause: Incorrect `sampling_hz` configuration (solution: verify config matches actual ADC rate (250 Hz), verify streaming rate is attainable at across data processing pipeline)

**BPM outliers:**
- Extremely high/low BPM values
- Potential cause: False peak detection or missed peaks (solution: adjust detection threshold or filter parameters, troubleshoot beat-detection algorithm)

---

## Next Steps

- ✅ Output files reference complete
- → See [Validation Framework](VALIDATION.md) for how these files are used
- → See [Usage Guide](USAGE.md) for generating these outputs

---

[← Back to Main README](../README.md) | [Documentation Index](DOCUMENTATION_INDEX.md)
